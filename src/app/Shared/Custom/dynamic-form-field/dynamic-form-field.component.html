<div class="dynamic-form-field space-y-2">
  <!-- Field Label -->
  <label [for]="getFieldId()" class="block text-sm font-semibold text-inputLabelColor">
    {{ field.field_name }}
    <span *ngIf="field.required" class="text-_red ml-1">*</span>
    <span *ngIf="field.field_name === 'KRA Number'" class="ml-2 text-gray-500 cursor-help"
      title="Enter a valid 10-11 character KRA PIN">?</span>
  </label>

  <!-- Text Input -->
  <div *ngIf="field.field_type === 'Text'" class="relative">
    <input [id]="getFieldId()" type="text" [value]="value" (input)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [placeholder]="getPlaceholder()" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full px-4 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 h-12 text-font_color placeholder-inputPlaceholderColor"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }" />
    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
      <svg *ngIf="hasError()" class="w-5 h-5 text-_red" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
          clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!hasError() && control?.valid && control?.touched" class="w-5 h-5 text-_green" fill="currentColor"
        viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Email Input -->
  <div *ngIf="field.field_type === 'Email'" class="relative">
    <div class="absolute inset-y-0 left-0 flex items-center pl-3">
      <svg class="w-5 h-5 text-gray_secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
      </svg>
    </div>
    <input [id]="getFieldId()" type="email" [value]="value" (input)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [placeholder]="getPlaceholder()" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full pl-10 pr-10 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 h-12 text-font_color placeholder-inputPlaceholderColor"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }" />
    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
      <svg *ngIf="hasError()" class="w-5 h-5 text-_red" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
          clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!hasError() && control?.valid && control?.touched" class="w-5 h-5 text-_green" fill="currentColor"
        viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Phone Input -->
  <div *ngIf="field.field_type === 'Phone'" class="relative">
    <div class="absolute inset-y-0 left-0 flex items-center pl-3">
      <svg class="w-5 h-5 text-gray_secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
      </svg>
    </div>
    <input [id]="getFieldId()" type="tel" [value]="value" (input)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [placeholder]="getPlaceholder()" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full pl-10 pr-10 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 h-12 text-font_color placeholder-inputPlaceholderColor"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }" />
    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
      <svg *ngIf="hasError()" class="w-5 h-5 text-_red" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
          clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!hasError() && control?.valid && control?.touched" class="w-5 h-5 text-_green" fill="currentColor"
        viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Number Input -->
  <div *ngIf="field.field_type === 'Number'" class="relative">
    <input [id]="getFieldId()" type="number" [value]="value" (input)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [placeholder]="getPlaceholder()" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full px-4 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 h-12 text-font_color placeholder-inputPlaceholderColor"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }" />
    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
      <svg *ngIf="hasError()" class="w-5 h-5 text-_red" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
          clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!hasError() && control?.valid && control?.touched" class="w-5 h-5 text-_green" fill="currentColor"
        viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Date Input -->
  <div *ngIf="field.field_type === 'Date'" class="relative">
    <div class="absolute inset-y-0 left-0 flex items-center pl-3 z-10">
      <svg class="w-5 h-5 text-gray_secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
    </div>
    <input [id]="getFieldId()" type="date" [value]="value" (input)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full pl-10 pr-10 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 h-12 text-font_color"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }" />
    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
      <svg *ngIf="hasError()" class="w-5 h-5 text-_red" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
          clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!hasError() && control?.valid && control?.touched" class="w-5 h-5 text-_green" fill="currentColor"
        viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Textarea -->
  <div *ngIf="field.field_type === 'Textarea'" class="relative">
    <textarea [id]="getFieldId()" [value]="value" (input)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [placeholder]="getPlaceholder()" rows="4" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full px-4 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 text-font_color placeholder-inputPlaceholderColor resize-none"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }"></textarea>
    <div class="absolute top-3 right-3">
      <svg *ngIf="hasError()" class="w-5 h-5 text-_red" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
          clip-rule="evenodd" />
      </svg>
      <svg *ngIf="!hasError() && control?.valid && control?.touched" class="w-5 h-5 text-_green" fill="currentColor"
        viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Select Dropdown -->
  <div *ngIf="field.field_type === 'Select'" class="relative">
    <select [id]="getFieldId()" [value]="value" (change)="onInputChange($event)" (blur)="onTouched()"
      [disabled]="disabled" [attr.aria-invalid]="hasError()"
      [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
      class="w-full px-4 py-3 bg-input_bg border border-transparent rounded-xl focus:ring-2 focus:ring-highlight_primary focus:border-highlight_primary focus:bg-white transition-all duration-300 h-12 text-font_color appearance-none cursor-pointer"
      [ngClass]="{
        'border-_red bg-red-50': hasError(),
        'bg-gray-100 cursor-not-allowed': disabled
      }">
      <option value="" disabled>Select {{ field.field_name.toLowerCase() }}</option>
      <option *ngFor="let option of field.options" [value]="option">{{ option }}</option>
    </select>
    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
      <svg class="w-5 h-5 text-gray_secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </div>

  <!-- Checkbox -->
  <div *ngIf="field.field_type === 'Checkbox'" class="flex items-start space-x-3">
    <div class="relative flex items-center">
      <input [id]="getFieldId()" type="checkbox" [checked]="value" (change)="onCheckboxChange($event)"
        (blur)="onTouched()" [disabled]="disabled" [attr.aria-invalid]="hasError()"
        [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
        class="w-5 h-5 text-highlight_primary bg-input_bg border-2 border-gray-300 rounded focus:ring-2 focus:ring-highlight_primary transition-all duration-200"
        [ngClass]="{
          'border-_red': hasError(),
          'opacity-50 cursor-not-allowed': disabled
        }" />
      <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
        <svg *ngIf="value" class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd"
            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
            clip-rule="evenodd" />
        </svg>
      </div>
    </div>
    <label [for]="getFieldId()" class="text-sm text-font_color cursor-pointer">
      I agree to the {{ field.field_name.toLowerCase() }}
    </label>
  </div>

  <!-- Radio Buttons -->
  <div *ngIf="field.field_type === 'Radio'" class="space-y-3">
    <div *ngFor="let option of field.options; let i = index" class="flex items-center space-x-3">
      <div class="relative">
        <input [id]="getFieldId() + '_' + i" type="radio" [name]="getFieldId()" [value]="option"
          [checked]="value === option" (change)="onInputChange($event)" (blur)="onTouched()" [disabled]="disabled"
          [attr.aria-invalid]="hasError()" [attr.aria-describedby]="hasError() ? getFieldId() + '_error' : null"
          class="w-5 h-5 text-highlight_primary bg-input_bg border-2 border-gray-300 focus:ring-2 focus:ring-highlight_primary transition-all duration-200"
          [ngClass]="{
            'border-_red': hasError(),
            'opacity-50 cursor-not-allowed': disabled
          }" />
      </div>
      <label [for]="getFieldId() + '_' + i" class="text-sm text-font_color cursor-pointer">
        {{ option }}
      </label>
    </div>
  </div>

  <!-- File Upload -->
  <div *ngIf="field.field_type === 'File'" class="space-y-3">
    <!-- Drop Zone -->
    <div class="relative border-2 border-dashed rounded-xl p-6 text-center transition-all duration-300 cursor-pointer"
      [ngClass]="{
        'border-highlight_primary bg-blue-50': dragOver,
        'border-gray-300 bg-input_bg hover:border-highlight_primary hover:bg-blue-50': !dragOver && !hasError(),
        'border-_red bg-red-50': hasError()
      }" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
      (click)="fileInput.click()">
      <input #fileInput type="file" [multiple]="false" (change)="onFileChange($event)" class="hidden"
        [accept]="field.field_name.toLowerCase().includes('image') ? 'image/*' : '*/*'" />
      <div class="space-y-3">
        <div class="mx-auto w-12 h-12 bg-highlight_primary bg-opacity-10 rounded-full flex items-center justify-center">
          <svg class="w-6 h-6 text-highlight_primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
        </div>
        <div>
          <p class="text-font_color font-medium">
            Drop your {{ field.field_name.toLowerCase() }} here, or
            <span class="text-highlight_primary">browse</span>
          </p>
          <p class="text-sm text-gray_secondary mt-1">
            Supports: PDF, DOC, DOCX, JPG, PNG (Max 10MB)
          </p>
        </div>
      </div>
    </div>

    <!-- Selected Files -->
    <div *ngIf="selectedFiles.length > 0" class="space-y-2">
      <div *ngFor="let file of selectedFiles; let i = index"
        class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-highlight_primary bg-opacity-10 rounded-lg flex items-center justify-center">
            <svg class="w-5 h-5 text-highlight_primary" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd"
                d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                clip-rule="evenodd" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-medium text-font_color">{{ file.name }}</p>
            <p class="text-xs text-gray_secondary">{{ formatFileSize(file.size) }}</p>
          </div>
        </div>
        <button type="button" (click)="removeFile(i)"
          class="p-1 text-gray_secondary hover:text-_red transition-colors duration-200">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="hasError()" [id]="getFieldId() + '_error'"
    class="flex items-center space-x-2 text-_red text-sm animate-pulse">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd"
        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
        clip-rule="evenodd" />
    </svg>
    <span>{{ getErrorMessage() }}</span>
  </div>

  <!-- Success Message -->
  <div *ngIf="!hasError() && control?.valid && control?.touched"
    class="flex items-center space-x-2 text-_green text-sm">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd"
        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
        clip-rule="evenodd" />
    </svg>
    <span>{{ field.field_name }} looks good!</span>
  </div>
</div>